# è´¦å·å¯åŠ¨å’ŒäºŒç»´ç ç™»å½• - å®Œæ•´å®æ–½æ–‡æ¡£

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

å®ç°äº†æ™ºèƒ½è´¦å·å¯åŠ¨ç³»ç»Ÿï¼Œæ”¯æŒï¼š
1. **å·²ç™»å½•è´¦å·**ï¼šç‚¹å‡»å¯åŠ¨æŒ‰é’®åˆ·æ–°çŠ¶æ€
2. **æœªç™»å½•è´¦å·**ï¼šè‡ªåŠ¨å¼¹å‡ºäºŒç»´ç æ‰«ç ç™»å½•
3. **å‰åç«¯å®Œæ•´å¯¹æ¥**ï¼šä½¿ç”¨æ ‡å‡†APIæ¥å£

---

## ğŸ”„ å®Œæ•´æµç¨‹

### æµç¨‹å›¾

```
ç”¨æˆ·ç‚¹å‡»å¯åŠ¨æŒ‰é’®
        â†“
è°ƒç”¨ POST /accounts/{id}/start
        â†“
ç­‰å¾… 2 ç§’é’Ÿ
        â†“
è°ƒç”¨ GET /accounts/{id}/status
        â†“
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚           â”‚
 status?      status?
 online    qr/connecting/offline
    â”‚           â”‚
    â†“           â†“
æ˜¾ç¤ºæˆåŠŸ    å¼¹å‡ºäºŒç»´ç 
åˆ·æ–°åˆ—è¡¨    å¼€å§‹è½®è¯¢
```

### è¯¦ç»†æ­¥éª¤

#### 1. **ç”¨æˆ·ç‚¹å‡»å¯åŠ¨æŒ‰é’®**
```tsx
onClick={(e) => handleToggleAccount(account.id, account.status, e)}
```

#### 2. **åˆ¤æ–­å½“å‰çŠ¶æ€**
```tsx
if (status === 'online') {
  // å·²åœ¨çº¿ â†’ åœæ­¢è´¦å·
  await stopAccount(accountId);
} else {
  // ç¦»çº¿ â†’ å¯åŠ¨è´¦å·
  await startAccount(accountId);
}
```

#### 3. **è°ƒç”¨å¯åŠ¨API**
```tsx
// POST /accounts/{accountId}/start
await api.accounts.start(accountId);
```

#### 4. **ç­‰å¾…åˆå§‹åŒ–**
```tsx
// ç­‰å¾… 2 ç§’è®© WhatsApp å®¢æˆ·ç«¯åˆå§‹åŒ–
await new Promise(resolve => setTimeout(resolve, 2000));
```

#### 5. **æ£€æŸ¥è´¦å·çŠ¶æ€**
```tsx
// GET /accounts/{accountId}/status
const statusResult = await api.accounts.getStatus(accountId);
```

#### 6. **æ ¹æ®çŠ¶æ€åšå‡ºå“åº”**

##### åœºæ™¯Aï¼šè´¦å·å·²ç™»å½•
```tsx
if (statusResult.status === 'online') {
  toast.success('è´¦å·å·²ä¸Šçº¿ï¼');
  refreshAccounts();  // åˆ·æ–°è´¦å·åˆ—è¡¨
}
```

##### åœºæ™¯Bï¼šéœ€è¦æ‰«ç ç™»å½•
```tsx
else if (statusResult.status === 'qr' || statusResult.status === 'connecting') {
  toast.info('è¯·æ‰«æäºŒç»´ç ç™»å½•');
  setQrAccountId(accountId);
  setShowQRDialog(true);  // æ˜¾ç¤ºäºŒç»´ç å¯¹è¯æ¡†
}
```

##### åœºæ™¯Cï¼šå…¶ä»–çŠ¶æ€
```tsx
else {
  // é»˜è®¤æ˜¾ç¤ºäºŒç»´ç 
  setQrAccountId(accountId);
  setShowQRDialog(true);
}
```

---

## ğŸ“± äºŒç»´ç ç™»å½•ç³»ç»Ÿ

### ç»„ä»¶æ›´æ–°

#### QRCodeDialog ç»„ä»¶æ”¹è¿›

**æ–°å¢ accountId å‚æ•°**
```tsx
interface QRCodeDialogProps {
  isOpen: boolean;
  onClose: () => void;
  onSuccess?: () => void;
  accountId: string | null;  // æ–°å¢ï¼šæ”¯æŒå¤šè´¦å·
}
```

**APIè°ƒç”¨æ›´æ–°**
```tsx
// æ—§ç‰ˆï¼ˆå•è´¦å·ï¼‰
const result = await api.getQRCode();

// æ–°ç‰ˆï¼ˆå¤šè´¦å·ï¼‰
const result = await api.accounts.getQRCode(accountId);
```

### äºŒç»´ç è½®è¯¢æœºåˆ¶

#### è½®è¯¢æµç¨‹
```
æ‰“å¼€å¯¹è¯æ¡†
    â†“
ç«‹å³è·å–äºŒç»´ç 
    â†“
ç­‰å¾… 4 ç§’
    â†“
å†æ¬¡è·å–äºŒç»´ç 
    â†“
æ£€æŸ¥çŠ¶æ€
    â†“
  â”Œâ”€â”€â”€â”´â”€â”€â”€â”
  â”‚       â”‚
online   å…¶ä»–
  â”‚       â”‚
  â†“       â†“
ç™»å½•æˆåŠŸ  ç»§ç»­è½®è¯¢
å…³é—­çª—å£
```

#### ä»£ç å®ç°
```tsx
useEffect(() => {
  if (!isOpen) return;

  let interval: NodeJS.Timeout | null = null;
  let isActive = true;

  const pollQRCode = async () => {
    if (!isActive) return;
    
    try {
      await fetchQRCode();
      // ç»§ç»­è½®è¯¢
      if (isActive && isOpen) {
        interval = setTimeout(pollQRCode, 4000);  // 4ç§’é—´éš”
      }
    } catch (error) {
      // å‡ºé”™åå»¶é•¿é—´éš”
      if (isActive && isOpen) {
        interval = setTimeout(pollQRCode, 8000);  // 8ç§’é—´éš”
      }
    }
  };

  void pollQRCode();

  return () => {
    isActive = false;
    if (interval) clearTimeout(interval);
  };
}, [fetchQRCode, isOpen]);
```

### è·å–äºŒç»´ç é€»è¾‘

```tsx
const fetchQRCode = useCallback(async () => {
  if (!accountId) {
    setStatus('è´¦å·IDä¸å­˜åœ¨');
    return;
  }
  
  setIsLoading(true);
  try {
    // 1. è·å–äºŒç»´ç 
    const result = await api.accounts.getQRCode(accountId);
    
    // 2. å¦‚æœæœ‰äºŒç»´ç ï¼Œç”Ÿæˆå›¾ç‰‡
    if (result.qr) {
      const dataUrl = await QRCode.toDataURL(result.qr, { 
        margin: 1, 
        width: 240 
      });
      setQrImage(dataUrl);
      setStatus('è¯·ä½¿ç”¨æ‰‹æœº WhatsApp æ‰«æäºŒç»´ç ');
    } 
    // 3. æ²¡æœ‰äºŒç»´ç ï¼Œæ£€æŸ¥çŠ¶æ€
    else {
      setQrImage(null);
      const statusResult = await api.accounts.getStatus(accountId);
      
      if (statusResult.status === 'online') {
        // ç™»å½•æˆåŠŸ
        setStatus('âœ… è´¦å·å·²ç™»å½•ï¼');
        setTimeout(() => {
          onSuccess?.();
          onClose();
        }, 1500);
      } else {
        setStatus('æ­£åœ¨åˆå§‹åŒ– WhatsApp å®¢æˆ·ç«¯...');
      }
    }
  } catch (error) {
    console.error('Failed to fetch QR code', error);
    setStatus(`è·å–äºŒç»´ç å¤±è´¥: ${error.message}`);
  } finally {
    setIsLoading(false);
  }
}, [accountId, onClose, onSuccess]);
```

---

## ğŸ”Œ APIæ¥å£å¯¹æ¥

### åç«¯APIæ¥å£

#### 1. å¯åŠ¨è´¦å·
```http
POST /accounts/:accountId/start
Authorization: Bearer {token}

Response:
{
  "ok": true,
  "data": {
    "message": "Account start initiated"
  }
}
```

#### 2. åœæ­¢è´¦å·
```http
POST /accounts/:accountId/stop
Authorization: Bearer {token}

Response:
{
  "ok": true,
  "data": {
    "message": "Account stopped"
  }
}
```

#### 3. è·å–è´¦å·çŠ¶æ€
```http
GET /accounts/:accountId/status
Authorization: Bearer {token}

Response:
{
  "ok": true,
  "data": {
    "accountId": "123",
    "status": "online",     // online | offline | connecting | qr
    "phoneNumber": "+86130...",
    "platform": "linux"
  }
}
```

#### 4. è·å–äºŒç»´ç 
```http
GET /accounts/:accountId/qr
Authorization: Bearer {token}

Response:
{
  "ok": true,
  "data": {
    "qr": "2@xxx...",       // äºŒç»´ç å­—ç¬¦ä¸²
    "accountId": "123"
  }
}
```

### å‰ç«¯APIå°è£…

```tsx
// web/lib/api.ts

export const api = {
  accounts: {
    // å¯åŠ¨è´¦å·
    start: (accountId: string) =>
      apiFetch<{ message: string }>(`/accounts/${accountId}/start`, {
        method: 'POST',
      }),
    
    // åœæ­¢è´¦å·
    stop: (accountId: string) =>
      apiFetch<{ message: string }>(`/accounts/${accountId}/stop`, {
        method: 'POST',
      }),
    
    // è·å–è´¦å·çŠ¶æ€
    getStatus: (accountId: string) =>
      apiFetch<any>(`/accounts/${accountId}/status`),
    
    // è·å–è´¦å·äºŒç»´ç 
    getQRCode: (accountId: string) =>
      apiFetch<{ qr: string | null }>(`/accounts/${accountId}/qr`),
  }
};
```

---

## ğŸ’» ç»„ä»¶é›†æˆ

### AccountSwitcher ç»„ä»¶

#### çŠ¶æ€ç®¡ç†
```tsx
const [loadingAccountId, setLoadingAccountId] = useState<string | null>(null);
const [showQRDialog, setShowQRDialog] = useState(false);
const [qrAccountId, setQrAccountId] = useState<string | null>(null);
```

#### å¯åŠ¨/åœæ­¢å¤„ç†
```tsx
const handleToggleAccount = async (accountId: string, status: string, e: React.MouseEvent) => {
  e.stopPropagation();
  setLoadingAccountId(accountId);
  
  try {
    if (status === 'online') {
      // åœæ­¢è´¦å·
      await stopAccount(accountId);
      toast.success('è´¦å·å·²åœæ­¢');
    } else {
      // å¯åŠ¨è´¦å·
      toast.info('æ­£åœ¨å¯åŠ¨è´¦å·...');
      await startAccount(accountId);
      
      // ç­‰å¾…åˆå§‹åŒ–
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      // æ£€æŸ¥çŠ¶æ€
      const statusResult = await api.accounts.getStatus(accountId);
      
      if (statusResult.status === 'online') {
        // å·²ç™»å½•
        toast.success('è´¦å·å·²ä¸Šçº¿ï¼');
        refreshAccounts();
      } else if (statusResult.status === 'qr' || statusResult.status === 'connecting') {
        // éœ€è¦æ‰«ç 
        toast.info('è¯·æ‰«æäºŒç»´ç ç™»å½•');
        setQrAccountId(accountId);
        setShowQRDialog(true);
      } else {
        // å…¶ä»–çŠ¶æ€
        toast.info('æ­£åœ¨è·å–ç™»å½•äºŒç»´ç ...');
        setQrAccountId(accountId);
        setShowQRDialog(true);
      }
    }
  } catch (error) {
    toast.error('æ“ä½œå¤±è´¥');
  } finally {
    setLoadingAccountId(null);
  }
};
```

#### JSXé›†æˆ
```tsx
return (
  <>
    {/* è´¦å·åˆ—è¡¨ */}
    <div>
      {filteredAccounts.map((account) => (
        <div key={account.id}>
          {/* å¯åŠ¨/åœæ­¢æŒ‰é’® */}
          <Button
            onClick={(e) => handleToggleAccount(account.id, account.status, e)}
            disabled={loadingAccountId === account.id}
          >
            {account.status === 'online' ? (
              <PowerOff className="h-3.5 w-3.5" />
            ) : (
              <Power className="h-3.5 w-3.5" />
            )}
          </Button>
        </div>
      ))}
    </div>
    
    {/* äºŒç»´ç å¯¹è¯æ¡† */}
    <QRCodeDialog
      isOpen={showQRDialog}
      onClose={() => {
        setShowQRDialog(false);
        setQrAccountId(null);
      }}
      accountId={qrAccountId}
      onSuccess={() => {
        setShowQRDialog(false);
        setQrAccountId(null);
        refreshAccounts();
        toast.success('è´¦å·ç™»å½•æˆåŠŸï¼');
      }}
    />
  </>
);
```

---

## ğŸ¨ ç”¨æˆ·ç•Œé¢

### å¯åŠ¨æŒ‰é’®æ˜¾ç¤º

#### åœ¨çº¿è´¦å·
```tsx
{account.status === 'online' ? (
  <Button variant="outline">
    <PowerOff className="h-3.5 w-3.5" />  // æ©™è‰²åœæ­¢å›¾æ ‡
  </Button>
) : (
  <Button variant="outline">
    <Power className="h-3.5 w-3.5" />     // ç»¿è‰²å¯åŠ¨å›¾æ ‡
  </Button>
)}
```

#### åŠ è½½çŠ¶æ€
```tsx
<Button
  variant="outline"
  disabled={loadingAccountId === account.id}
>
  {loadingAccountId === account.id ? (
    <Loader2 className="h-3.5 w-3.5 animate-spin" />
  ) : (
    <Power className="h-3.5 w-3.5" />
  )}
</Button>
```

### äºŒç»´ç å¯¹è¯æ¡†UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    WhatsApp ç™»å½•                â”‚
â”‚                                 â”‚
â”‚  è¯·ä½¿ç”¨æ‰‹æœº WhatsApp æ‰«æäºŒç»´ç   â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚       [QR CODE]           â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚
â”‚  â”‚                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚
â”‚  è¯·ä½¿ç”¨ WhatsApp æ‰«æäºŒç»´ç       â”‚
â”‚       å®Œæˆç™»å½•                  â”‚
â”‚                                 â”‚
â”‚  [åˆ·æ–°äºŒç»´ç ]      [å…³é—­]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š çŠ¶æ€è¯´æ˜

### è´¦å·çŠ¶æ€æšä¸¾

| çŠ¶æ€ | è¯´æ˜ | æ˜¾ç¤º | æ“ä½œ |
|-----|------|------|------|
| `online` | å·²ç™»å½• | ç»¿è‰²"åœ¨çº¿" | æ˜¾ç¤ºåœæ­¢æŒ‰é’® |
| `offline` | ç¦»çº¿ | ç°è‰²"ç¦»çº¿" | æ˜¾ç¤ºå¯åŠ¨æŒ‰é’® |
| `connecting` | è¿æ¥ä¸­ | æ©™è‰²"è¿æ¥ä¸­" | ç¦ç”¨æŒ‰é’® |
| `qr` | å¾…æ‰«ç  | çº¢è‰²"å¾…æ‰«ç " | æ˜¾ç¤ºäºŒç»´ç  |

### çŠ¶æ€è½¬æ¢

```
offline
  â†“ ç‚¹å‡»å¯åŠ¨
connecting
  â†“ 2ç§’å
  â”œâ”€â†’ online (å·²ç™»å½•)
  â””â”€â†’ qr (éœ€æ‰«ç )
         â†“ æ‰«ç æˆåŠŸ
       online
```

---

## ğŸ¯ Toasté€šçŸ¥

### é€šçŸ¥æ—¶æœº

| æ“ä½œ | é€šçŸ¥å†…å®¹ | ç±»å‹ |
|-----|---------|------|
| ç‚¹å‡»å¯åŠ¨ | "æ­£åœ¨å¯åŠ¨è´¦å·..." | info |
| å¯åŠ¨æˆåŠŸï¼ˆå·²ç™»å½•ï¼‰ | "è´¦å·å·²ä¸Šçº¿ï¼" | success |
| éœ€è¦æ‰«ç  | "è¯·æ‰«æäºŒç»´ç ç™»å½•" | info |
| è·å–äºŒç»´ç  | "æ­£åœ¨è·å–ç™»å½•äºŒç»´ç ..." | info |
| æ‰«ç æˆåŠŸ | "è´¦å·ç™»å½•æˆåŠŸï¼" | success |
| åœæ­¢è´¦å· | "è´¦å·å·²åœæ­¢" | success |
| æ“ä½œå¤±è´¥ | "æ“ä½œå¤±è´¥" | error |

### Toastå®ç°
```tsx
import { toast } from 'sonner';

// ä¿¡æ¯æç¤º
toast.info('æ­£åœ¨å¯åŠ¨è´¦å·...');

// æˆåŠŸæç¤º
toast.success('è´¦å·å·²ä¸Šçº¿ï¼');

// é”™è¯¯æç¤º
toast.error('æ“ä½œå¤±è´¥');
```

---

## ğŸ”§ é”™è¯¯å¤„ç†

### ç½‘ç»œé”™è¯¯
```tsx
try {
  await startAccount(accountId);
} catch (error) {
  const message = error instanceof Error ? error.message : 'æ“ä½œå¤±è´¥';
  toast.error(message);
  console.error('Toggle account error:', error);
}
```

### çŠ¶æ€æ£€æŸ¥å¤±è´¥
```tsx
try {
  const statusResult = await api.accounts.getStatus(accountId);
  // å¤„ç†çŠ¶æ€...
} catch (statusError) {
  // çŠ¶æ€æ£€æŸ¥å¤±è´¥ï¼Œå°è¯•æ˜¾ç¤ºäºŒç»´ç 
  console.warn('Status check failed:', statusError);
  setQrAccountId(accountId);
  setShowQRDialog(true);
}
```

### äºŒç»´ç è·å–å¤±è´¥
```tsx
try {
  const result = await api.accounts.getQRCode(accountId);
  // å¤„ç†äºŒç»´ç ...
} catch (error) {
  console.error('Failed to fetch QR code', error);
  const message = error instanceof Error ? error.message : String(error);
  setStatus(`è·å–äºŒç»´ç å¤±è´¥: ${message}`);
  setQrImage(null);
}
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. é˜²æŠ–å¤„ç†
```tsx
// æŒ‰é’®ç¦ç”¨é˜²æ­¢é‡å¤ç‚¹å‡»
<Button
  disabled={loadingAccountId === account.id}
  onClick={handleToggleAccount}
>
```

### 2. è½®è¯¢ä¼˜åŒ–
```tsx
// æ­£å¸¸è½®è¯¢ï¼š4ç§’
interval = setTimeout(pollQRCode, 4000);

// é”™è¯¯åè½®è¯¢ï¼š8ç§’
interval = setTimeout(pollQRCode, 8000);
```

### 3. ç»„ä»¶å¸è½½æ¸…ç†
```tsx
useEffect(() => {
  let isActive = true;
  
  // è½®è¯¢é€»è¾‘...
  
  return () => {
    isActive = false;  // é˜²æ­¢å†…å­˜æ³„æ¼
    if (interval) clearTimeout(interval);
  };
}, []);
```

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯1ï¼šé¦–æ¬¡ç™»å½•è´¦å·
1. ç‚¹å‡»ç¦»çº¿è´¦å·çš„å¯åŠ¨æŒ‰é’®
2. æ˜¾ç¤º "æ­£åœ¨å¯åŠ¨è´¦å·..."
3. 2ç§’åå¼¹å‡ºäºŒç»´ç å¯¹è¯æ¡†
4. ç”¨æ‰‹æœºWhatsAppæ‰«æäºŒç»´ç 
5. æ‰«ç æˆåŠŸåæ˜¾ç¤º "è´¦å·ç™»å½•æˆåŠŸï¼"
6. å¯¹è¯æ¡†å…³é—­ï¼Œè´¦å·åˆ—è¡¨åˆ·æ–°
7. è´¦å·çŠ¶æ€å˜ä¸º "åœ¨çº¿"

### åœºæ™¯2ï¼šå·²ç™»å½•è´¦å·é‡å¯
1. ç‚¹å‡»å·²ç™»å½•è´¦å·çš„å¯åŠ¨æŒ‰é’®
2. æ˜¾ç¤º "æ­£åœ¨å¯åŠ¨è´¦å·..."
3. 2ç§’åæ˜¾ç¤º "è´¦å·å·²ä¸Šçº¿ï¼"
4. è´¦å·åˆ—è¡¨åˆ·æ–°
5. æ— éœ€æ‰«ç 

### åœºæ™¯3ï¼šåœæ­¢è´¦å·
1. ç‚¹å‡»åœ¨çº¿è´¦å·çš„åœæ­¢æŒ‰é’®ï¼ˆæ©™è‰²å›¾æ ‡ï¼‰
2. æ˜¾ç¤º "è´¦å·å·²åœæ­¢"
3. è´¦å·çŠ¶æ€å˜ä¸º "ç¦»çº¿"

### åœºæ™¯4ï¼šç½‘ç»œé”™è¯¯
1. æ–­å¼€ç½‘ç»œ
2. ç‚¹å‡»å¯åŠ¨æŒ‰é’®
3. æ˜¾ç¤º "æ“ä½œå¤±è´¥"
4. æŒ‰é’®æ¢å¤å¯ç”¨çŠ¶æ€

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. **ç­‰å¾…æ—¶é—´**
- å¯åŠ¨åç­‰å¾…2ç§’æ˜¯å¿…è¦çš„
- ç»™WhatsAppå®¢æˆ·ç«¯è¶³å¤Ÿçš„åˆå§‹åŒ–æ—¶é—´
- ä¸è¦å‡å°‘è¿™ä¸ªç­‰å¾…æ—¶é—´

### 2. **è½®è¯¢é¢‘ç‡**
- æ­£å¸¸æƒ…å†µï¼š4ç§’
- å‡ºé”™æƒ…å†µï¼š8ç§’
- ä¸è¦è®¾ç½®å¤ªçŸ­ï¼Œé¿å…æœåŠ¡å™¨å‹åŠ›

### 3. **çŠ¶æ€åŒæ­¥**
- æ‰«ç æˆåŠŸåå¿…é¡»è°ƒç”¨ `refreshAccounts()`
- ç¡®ä¿æ‰€æœ‰åœ°æ–¹çš„çŠ¶æ€ä¸€è‡´
- å…³é—­å¯¹è¯æ¡†å‰æ¸…ç†çŠ¶æ€

### 4. **é”™è¯¯å¤„ç†**
- æ‰€æœ‰APIè°ƒç”¨éƒ½è¦try-catch
- æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
- å¤±è´¥åæ¢å¤æŒ‰é’®çŠ¶æ€

### 5. **ç”¨æˆ·ä½“éªŒ**
- æ˜¾ç¤ºåŠ è½½çŠ¶æ€
- æä¾›å³æ—¶åé¦ˆ
- Toasté€šçŸ¥è¦æ¸…æ™°

---

## ğŸš€ æœªæ¥æ‰©å±•

### å¯èƒ½çš„æ”¹è¿›

1. **æ™ºèƒ½é‡è¯•**
   - ç½‘ç»œå¤±è´¥è‡ªåŠ¨é‡è¯•
   - æŒ‡æ•°é€€é¿ç­–ç•¥

2. **çŠ¶æ€ç¼“å­˜**
   - ç¼“å­˜è´¦å·çŠ¶æ€
   - å‡å°‘APIè°ƒç”¨

3. **æ‰¹é‡æ“ä½œ**
   - æ‰¹é‡å¯åŠ¨è´¦å·
   - æ‰¹é‡åœæ­¢è´¦å·

4. **é€šçŸ¥å¢å¼º**
   - å£°éŸ³æé†’
   - æ¡Œé¢é€šçŸ¥
   - é‚®ä»¶é€šçŸ¥

5. **æ—¥å¿—è®°å½•**
   - æ“ä½œæ—¥å¿—
   - é”™è¯¯æ—¥å¿—
   - ç™»å½•å†å²

---

## âœ… å®Œæˆæ£€æŸ¥æ¸…å•

- [x] QRCodeDialogæ”¯æŒaccountIdå‚æ•°
- [x] AccountSwitcheré›†æˆäºŒç»´ç ç™»å½•
- [x] å¯åŠ¨æŒ‰é’®æ™ºèƒ½åˆ¤æ–­çŠ¶æ€
- [x] å·²ç™»å½•è´¦å·åˆ·æ–°çŠ¶æ€
- [x] æœªç™»å½•è´¦å·å¼¹å‡ºäºŒç»´ç 
- [x] äºŒç»´ç è½®è¯¢æœºåˆ¶
- [x] æ‰«ç æˆåŠŸè‡ªåŠ¨å…³é—­
- [x] Toasté€šçŸ¥å®Œæ•´
- [x] é”™è¯¯å¤„ç†å®Œå–„
- [x] åŠ è½½çŠ¶æ€æ˜¾ç¤º
- [x] APIå®Œæ•´å¯¹æ¥
- [x] å¤šè´¦å·æ”¯æŒ
- [x] æ— Linté”™è¯¯

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

### ä¿®æ”¹çš„æ–‡ä»¶
1. `web/components/QRCodeDialog.tsx` - æ”¯æŒå¤šè´¦å·
2. `web/components/account/AccountSwitcher.tsx` - æ™ºèƒ½å¯åŠ¨é€»è¾‘
3. `web/lib/api.ts` - APIæ¥å£å°è£…ï¼ˆæ— éœ€ä¿®æ”¹ï¼Œå·²å®Œå–„ï¼‰

### ä½¿ç”¨çš„ç»„ä»¶
- `QRCodeDialog` - äºŒç»´ç æ˜¾ç¤ºå’Œè½®è¯¢
- `AccountSwitcher` - è´¦å·åˆ‡æ¢å’Œç®¡ç†
- `Button` - æ“ä½œæŒ‰é’®
- `toast` - é€šçŸ¥æç¤º

### APIæ¥å£
- `POST /accounts/:id/start` - å¯åŠ¨è´¦å·
- `POST /accounts/:id/stop` - åœæ­¢è´¦å·
- `GET /accounts/:id/status` - è·å–çŠ¶æ€
- `GET /accounts/:id/qr` - è·å–äºŒç»´ç 

---

## ğŸ‰ æ€»ç»“

ç°åœ¨çš„è´¦å·å¯åŠ¨ç³»ç»Ÿï¼š

âœ… **æ™ºèƒ½åˆ¤æ–­** - è‡ªåŠ¨è¯†åˆ«æ˜¯å¦éœ€è¦ç™»å½•  
âœ… **æ— ç¼ä½“éªŒ** - å·²ç™»å½•è´¦å·ç›´æ¥åˆ·æ–°  
âœ… **æ‰«ç ç™»å½•** - æœªç™»å½•è‡ªåŠ¨å¼¹å‡ºäºŒç»´ç   
âœ… **å®æ—¶è½®è¯¢** - è‡ªåŠ¨æ£€æµ‹ç™»å½•çŠ¶æ€  
âœ… **å®Œæ•´åé¦ˆ** - Toasté€šçŸ¥æ¸…æ™°æ˜ç¡®  
âœ… **é”™è¯¯å¤„ç†** - æ‰€æœ‰å¼‚å¸¸éƒ½æœ‰å¤„ç†  
âœ… **å¤šè´¦å·æ”¯æŒ** - å®Œç¾æ”¯æŒå¤šä¸ªè´¦å·  

ç”¨æˆ·ä½“éªŒæä½³ï¼Œå¼€å‘ç»´æŠ¤æ–¹ä¾¿ï¼ğŸš€


# ğŸ”§ å¤šè´¦å·æ¶æ„-å®Œæ•´ä¿®å¤æŠ¥å‘Š

## ğŸ“‹ ä¿®å¤èŒƒå›´

æ£€æµ‹åˆ°é¡¹ç›®ä¸­ **1ä¸ªåç«¯** å’Œ **11ä¸ªå‰ç«¯æ–‡ä»¶** ä»åœ¨ä½¿ç”¨æ—§çš„å•è´¦å·APIï¼Œéœ€è¦æ›´æ–°ä¸ºå¤šè´¦å·æ¶æ„ã€‚

---

## âœ… å·²å®Œæˆä¿®å¤

### 1ï¸âƒ£ é€šè®¯å½•-åŒæ­¥ç¾¤ç»„åŠŸèƒ½ âœ…
**æ–‡ä»¶**ï¼š`web/app/contacts/page.tsx`  
**é—®é¢˜**ï¼šä½¿ç”¨ `api.getStatus()` è°ƒç”¨å·²åºŸå¼ƒè·¯ç”±  
**ä¿®å¤**ï¼šæ”¹ç”¨ `api.accounts.getStatus(currentAccountId)`  
**çŠ¶æ€**ï¼šâœ… å®Œæˆ

### 2ï¸âƒ£ é€šè®¯å½•-åŒæ­¥ç¾¤æˆå‘˜åŠŸèƒ½ âœ…
**æ–‡ä»¶**ï¼š
- `server/app/src/routes/groups.ts`
- `server/app/src/services/group-service.ts`
- `server/app/src/wppconnect-service.ts`

**é—®é¢˜**ï¼š
- è·¯ç”±æœªä¼ é€’ `whatsappService` å®ä¾‹
- `syncGroupMembers` æ–¹æ³•æœªå®ç°å¤šè´¦å·æ”¯æŒ
- æ•°æ®åº“å­—æ®µåä¸åŒ¹é…

**ä¿®å¤**ï¼š
1. âœ… è·¯ç”±æ·»åŠ  `accountId` éªŒè¯å’Œ `whatsappService` è·å–
2. âœ… å®ç°å®Œæ•´çš„ç¾¤æˆå‘˜åŒæ­¥é€»è¾‘
3. âœ… æ·»åŠ  `getGroupParticipants` æ–¹æ³•åˆ° WPPConnectæœåŠ¡
4. âœ… ä¿®æ­£æ•°æ®åº“å­—æ®µåï¼š
   - `chatId` â†’ `groupId`
   - `groupParticipant` â†’ `groupMember`
   - `participantCount` â†’ `memberCount`
   - `isAdmin` â†’ `role` (ä½¿ç”¨ 'admin' æˆ– 'member')
   - `name` â†’ `displayName`

**çŠ¶æ€**ï¼šâœ… å®Œæˆå¹¶é€šè¿‡ç¼–è¯‘

---

## â³ å¾…ä¿®å¤åˆ—è¡¨

### ğŸ”´ åç«¯ (1ä¸ª)

#### 1. Campaign Runner åŠŸèƒ½
**æ–‡ä»¶**ï¼š`server/app/src/services/campaign-runner.ts`  
**é—®é¢˜**ï¼šç›´æ¥æŠ›å‡ºé”™è¯¯ "Campaign runner needs refactoring for multi-account support"  
**éœ€è¦**ï¼šé‡æ„ä¸ºæ¥æ”¶ `whatsappService` å‚æ•°

---

### ğŸ”´ å‰ç«¯ (11ä¸ªæ–‡ä»¶)

#### é—®é¢˜åˆ†ç±»ï¼š

**A. ä½¿ç”¨ `api.getStatus()`ï¼ˆæ—§çš„å…¨å±€çŠ¶æ€APIï¼‰**
1. `web/components/auth/login-modal.tsx`
2. `web/components/dashboard/account-dialog.tsx`
3. `web/components/dashboard/status-dialog.tsx`
4. `web/components/dashboard/settings-dialog.tsx`
5. `web/app/settings/page.tsx`
6. `web/components/dashboard/status-card.tsx`
7. `web/components/account/AccountDrawer.tsx`

**B. ä½¿ç”¨ `api.getContacts()`ï¼ˆæ—§çš„å…¨å±€è”ç³»äººAPIï¼‰**
8. `web/app/contacts/page.tsx`
9. `web/components/ContactSelector.tsx`
10. `web/app/chat/group/[id]/page.tsx`
11. `web/components/contacts/contacts-table.tsx`
12. `web/app/batch/send/page.tsx`

**C. ä½¿ç”¨ `api.createContact()`ï¼ˆæ—§çš„å…¨å±€åˆ›å»ºè”ç³»äººAPIï¼‰**
13. `web/app/contacts/page.tsx`
14. `web/app/chat/group/[id]/page.tsx`
15. `web/components/contacts/contacts-table.tsx`

---

## ğŸ¯ ä¿®å¤æ–¹æ¡ˆ

### åç«¯ä¿®å¤æ–¹æ¡ˆ

```typescript
// âŒ æ—§ä»£ç 
throw new Error('Campaign runner needs refactoring for multi-account support');

// âœ… æ–°ä»£ç 
async function executeCampaign(
  campaignId: string, 
  whatsappService: WPPConnectService  // æ·»åŠ å‚æ•°
) {
  // ä½¿ç”¨ä¼ å…¥çš„ whatsappService å®ä¾‹
  await whatsappService.sendTextMessage(...);
}
```

### å‰ç«¯ä¿®å¤æ–¹æ¡ˆ

#### A. ä¿®å¤ `api.getStatus()`
```typescript
// âŒ æ—§ä»£ç 
const status = await api.getStatus();

// âœ… æ–°ä»£ç 
const { currentAccountId } = useAccount();
if (!currentAccountId) {
  // å¤„ç†æœªé€‰æ‹©è´¦å·çš„æƒ…å†µ
  return;
}
const status = await api.accounts.getStatus(currentAccountId);
```

#### B. ä¿®å¤ `api.getContacts()`
```typescript
// âŒ æ—§ä»£ç 
const contacts = await api.getContacts();

// âœ… æ–°ä»£ç 
const { currentAccountId } = useAccount();
if (!currentAccountId) {
  // å¤„ç†æœªé€‰æ‹©è´¦å·çš„æƒ…å†µ
  return;
}
const contacts = await api.contacts.list(currentAccountId);
```

# èŠå¤©é¡µé¢é›†æˆ - ä»£ç è¡¥ä¸

æœ¬æ–‡ä»¶åŒ…å«æ‰€æœ‰éœ€è¦æ·»åŠ åˆ° `web/app/chat/[id]/page.tsx` çš„ä»£ç ç‰‡æ®µï¼ŒæŒ‰æ­¥éª¤åˆ†è§£ã€‚

---

## æ­¥éª¤ 1: æ·»åŠ æ–°ç»„ä»¶å¯¼å…¥

åœ¨æ–‡ä»¶é¡¶éƒ¨çš„å¯¼å…¥åŒºåŸŸï¼ˆç¬¬9è¡Œåï¼‰æ·»åŠ ï¼š

```typescript
// æ–°å¢ï¼šåª’ä½“ç»„ä»¶
import MediaPreview from '@/components/media/MediaPreview';
import MediaUploader from '@/components/media/MediaUploader';

// æ–°å¢ï¼šæ¶ˆæ¯æ“ä½œç»„ä»¶
import QuotedMessage from '@/components/chat/QuotedMessage';
import MessageContextMenu, { getMessageMenuItems } from '@/components/chat/MessageContextMenu';
import MessageEditor from '@/components/chat/MessageEditor';
import ForwardDialog from '@/components/chat/ForwardDialog';

// æ–°å¢ï¼šèŠå¤©è¾…åŠ©ç»„ä»¶
import MessageSearch from '@/components/chat/MessageSearch';
import ThreadLabels from '@/components/chat/ThreadLabels';
```

---

## æ­¥éª¤ 2: æ·»åŠ æ–°çš„çŠ¶æ€å˜é‡

åœ¨ `ChatPage` ç»„ä»¶å†…éƒ¨ï¼Œç°æœ‰çŠ¶æ€å£°æ˜åæ·»åŠ ï¼š

```typescript
// åœ¨ç°æœ‰çŠ¶æ€åæ·»åŠ 

// æ–°å¢ï¼šæ¶ˆæ¯æ“ä½œç›¸å…³çŠ¶æ€
const [replyToMessage, setReplyToMessage] = useState<any | null>(null);
const [editingMessageId, setEditingMessageId] = useState<string | null>(null);

// æ–°å¢ï¼šå¯¹è¯æ¡†çŠ¶æ€
const [showForwardDialog, setShowForwardDialog] = useState(false);
const [forwardMessage, setForwardMessage] = useState<any | null>(null);
const [showMediaUploader, setShowMediaUploader] = useState(false);

// æ–°å¢ï¼šUI çŠ¶æ€
const [showSearch, setShowSearch] = useState(false);

// æ–°å¢ï¼šå³é”®èœå•çŠ¶æ€
const [contextMenu, setContextMenu] = useState<{
  show: boolean;
  x: number;
  y: number;
  message: any;
} | null>(null);

// æ–°å¢ï¼šåˆ†é¡µåŠ è½½çŠ¶æ€
const [hasMoreMessages, setHasMoreMessages] = useState(true);
const [loadingMoreMessages, setLoadingMoreMessages] = useState(false);

// æ–°å¢ï¼šè‰ç¨¿è‡ªåŠ¨ä¿å­˜å®šæ—¶å™¨
const draftSaveTimerRef = useRef<NodeJS.Timeout>();
```

---

## æ­¥éª¤ 3: æ·»åŠ è‰ç¨¿è‡ªåŠ¨ä¿å­˜

åœ¨ `useEffect` åŒºåŸŸæ·»åŠ ï¼š

```typescript
// è‰ç¨¿è‡ªåŠ¨ä¿å­˜
useEffect(() => {
  if (!threadId || !inputMessage) return;
  
  // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
  if (draftSaveTimerRef.current) {
    clearTimeout(draftSaveTimerRef.current);
  }
  
  // å»¶è¿Ÿä¿å­˜è‰ç¨¿ï¼ˆé˜²æŠ–ï¼‰
  draftSaveTimerRef.current = setTimeout(async () => {
    try {
      await api.threads.saveDraft(threadId, inputMessage);
      console.log('ğŸ’¾ è‰ç¨¿å·²ä¿å­˜');
    } catch (error) {
      console.error('ä¿å­˜è‰ç¨¿å¤±è´¥:', error);
    }
  }, 1000);
  
  return () => {
    if (draftSaveTimerRef.current) {
      clearTimeout(draftSaveTimerRef.current);
    }
  };
}, [inputMessage, threadId]);
```

---

## æ­¥éª¤ 4: ä¿®æ”¹ `loadThread` å‡½æ•°

åœ¨ç°æœ‰çš„ `loadThread` å‡½æ•°ä¸­æ·»åŠ åŠ è½½è‰ç¨¿çš„é€»è¾‘ï¼š

```typescript
const loadThread = async () => {
  // ... ç°æœ‰ä»£ç ä¿æŒä¸å˜ ...
  
  // åœ¨è®¾ç½® messages ä¹‹åæ·»åŠ ï¼š
  
  // æ–°å¢ï¼šåŠ è½½è‰ç¨¿
  try {
    const draft = await api.threads.getDraft(threadId);
    if (draft?.draft) {
      setInputMessage(draft.draft);
    }
  } catch (error) {
    console.error('åŠ è½½è‰ç¨¿å¤±è´¥:', error);
  }
  
  // ... å…¶ä½™ä»£ç ä¿æŒä¸å˜ ...
};
```

---

## æ­¥éª¤ 5: æ·»åŠ åˆ†é¡µåŠ è½½å‡½æ•°

åœ¨ç»„ä»¶å†…æ·»åŠ æ–°å‡½æ•°ï¼š

```typescript
// åŠ è½½æ›´å¤šå†å²æ¶ˆæ¯
const loadMoreMessages = async () => {
  if (!threadId || loadingMoreMessages || !hasMoreMessages) return;
  
  try {
    setLoadingMoreMessages(true);
    
    // è·å–æœ€æ—©çš„æ¶ˆæ¯æ—¶é—´
    const oldestMessage = messages[0];
    const before = oldestMessage?.createdAt;
    
    const data = await api.threads.getMessages(threadId, 50, before);
    
    if (data.messages && data.messages.length > 0) {
      // ä¿å­˜å½“å‰æ»šåŠ¨ä½ç½®
      const container = messageContainerRef.current;
      const oldScrollHeight = container?.scrollHeight || 0;
      
      // æ·»åŠ å†å²æ¶ˆæ¯åˆ°åˆ—è¡¨é¡¶éƒ¨
      setMessages((prev) => [...data.messages, ...prev]);
      setHasMoreMessages(data.hasMore || false);
      
      // æ¢å¤æ»šåŠ¨ä½ç½®
      setTimeout(() => {
        if (container) {
          const newScrollHeight = container.scrollHeight;
          container.scrollTop = newScrollHeight - oldScrollHeight;
        }
      }, 0);
    } else {
      setHasMoreMessages(false);
    }
  } catch (error) {
    console.error('åŠ è½½å†å²æ¶ˆæ¯å¤±è´¥:', error);
  } finally {
    setLoadingMoreMessages(false);
  }
};

// ç›‘å¬æ»šåŠ¨äº‹ä»¶
const handleScroll = useCallback(() => {
  const container = messageContainerRef.current;
  if (!container) return;
  
  // æ»šåŠ¨åˆ°é¡¶éƒ¨æ—¶åŠ è½½æ›´å¤š
  if (container.scrollTop < 100) {
    loadMoreMessages();
  }
}, [loadingMoreMessages, hasMoreMessages]);

// æ·»åŠ æ»šåŠ¨ç›‘å¬
useEffect(() => {
  const container = messageContainerRef.current;
  if (!container) return;
  
  container.addEventListener('scroll', handleScroll);
  return () => container.removeEventListener('scroll', handleScroll);
}, [handleScroll]);
```

---

## æ­¥éª¤ 6: æ·»åŠ æ¶ˆæ¯æ“ä½œå‡½æ•°

```typescript
// å³é”®èœå•å¤„ç†
const handleMessageContextMenu = (e: React.MouseEvent, message: any) => {
  e.preventDefault();
  setContextMenu({
    show: true,
    x: e.clientX,
    y: e.clientY,
    message,
  });
};

// å¼•ç”¨æ¶ˆæ¯
const handleReplyMessage = (message: any) => {
  setReplyToMessage(message);
  setContextMenu(null);
  inputRef.current?.focus();
};

// ç¼–è¾‘æ¶ˆæ¯
const handleEditMessage = async (messageId: string, newText: string) => {
  try {
    await api.messages.edit(messageId, newText);
    setEditingMessageId(null);
    console.log('âœ… æ¶ˆæ¯å·²ç¼–è¾‘');
  } catch (error) {
    console.error('ç¼–è¾‘æ¶ˆæ¯å¤±è´¥:', error);
    throw error;
  }
};

// åˆ é™¤æ¶ˆæ¯
const handleDeleteMessage = async (message: any) => {
  if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡æ¶ˆæ¯å—ï¼Ÿ')) return;
  
  try {
    await api.messages.delete(message.id);
    setContextMenu(null);
    console.log('âœ… æ¶ˆæ¯å·²åˆ é™¤');
  } catch (error) {
    console.error('åˆ é™¤æ¶ˆæ¯å¤±è´¥:', error);
    alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•');
  }
};

// è½¬å‘æ¶ˆæ¯
const handleForwardMessage = async (threadIds: string[]) => {
  if (!forwardMessage) return;
  
  try {
    await api.messages.forward(forwardMessage.id, threadIds);
    setShowForwardDialog(false);
    setForwardMessage(null);
    setContextMenu(null);
    console.log(`âœ… æ¶ˆæ¯å·²è½¬å‘åˆ° ${threadIds.length} ä¸ªä¼šè¯`);
    alert(`æ¶ˆæ¯å·²è½¬å‘åˆ° ${threadIds.length} ä¸ªä¼šè¯`);
  } catch (error) {
    console.error('è½¬å‘æ¶ˆæ¯å¤±è´¥:', error);
    throw error;
  }
};

// æ ‡è®°æ˜Ÿæ ‡
const handleStarMessage = async (message: any) => {
  try {
    await api.messages.star(message.id, !message.isStarred);
    setContextMenu(null);
    
    setMessages((prev) =>
      prev.map((msg) =>
        msg.id === message.id
          ? { ...msg, isStarred: !msg.isStarred }
          : msg
      )
    );
  } catch (error) {
    console.error('æ ‡è®°æ¶ˆæ¯å¤±è´¥:', error);
    alert('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•');
  }
};

// å¤åˆ¶æ¶ˆæ¯
const handleCopyMessage = (message: any) => {
  if (message.text) {
    navigator.clipboard.writeText(message.text);
    alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
    setContextMenu(null);
  }
};

// åª’ä½“ä¸Šä¼ 
const handleMediaUpload = async (result: any) => {
  if (!threadId) return;
  
  try {
    const messageData = {
      threadId,
      text: result.fileName || '',
      mediaUrl: result.url,
      mediaType: result.type,
      mediaMimeType: result.mimeType,
      mediaSize: result.size,
      mediaFileName: result.fileName,
      thumbnailUrl: result.thumbnailUrl,
    };
    
    await api.sendMessage(threadId, '', messageData);
    setShowMediaUploader(false);
    console.log('âœ… åª’ä½“æ–‡ä»¶å·²å‘é€');
  } catch (error) {
    console.error('å‘é€åª’ä½“æ¶ˆæ¯å¤±è´¥:', error);
    alert('å‘é€å¤±è´¥ï¼Œè¯·é‡è¯•');
  }
};
```

---

## æ­¥éª¤ 7: ä¿®æ”¹ `handleSendMessage` å‡½æ•°

æ›´æ–°å‘é€æ¶ˆæ¯å‡½æ•°ä»¥æ”¯æŒå¼•ç”¨å›å¤ï¼š

```typescript
const handleSendMessage = async () => {
  if (!inputMessage.trim() || sending || !threadId) return;
  
  try {
    setSending(true);
    
    // æ–°å¢ï¼šå¦‚æœæœ‰å¼•ç”¨æ¶ˆæ¯ï¼Œä½¿ç”¨å¼•ç”¨API
    if (replyToMessage) {
      await api.messages.reply(threadId, inputMessage.trim(), replyToMessage.id);
    } else {
      await api.sendMessage(threadId, inputMessage.trim());
    }
    
    // æ¸…ç©ºè¾“å…¥å’Œå¼•ç”¨
    setInputMessage('');
    setReplyToMessage(null);  // æ–°å¢
    setSending(false);
    
    // æ–°å¢ï¼šæ¸…é™¤è‰ç¨¿
    api.threads.saveDraft(threadId, '').catch(console.error);
    
    inputRef.current?.focus();
  } catch (error: any) {
    console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error);
    alert('å‘é€å¤±è´¥: ' + error.message);
    setSending(false);
  }
};
```

---

## æ­¥éª¤ 8: æ›´æ–° WebSocket äº‹ä»¶å¤„ç†

åœ¨ç°æœ‰çš„ WebSocket useEffect ä¸­æ·»åŠ æ–°äº‹ä»¶ï¼š

```typescript
useEffect(() => {
  if (!lastMessage) return;
  
  const { type, data } = lastMessage;
  
  switch (type) {
    case 'new_message':
      handleNewMessage(data);
      break;
      
    // æ–°å¢äº‹ä»¶å¤„ç†
    case 'message_edited':
      setMessages((prev) =>
        prev.map((msg) =>
          msg.id === data.messageId
            ? { ...msg, text: data.text, isEdited: true, editedAt: data.editedAt }
            : msg
        )
      );
      break;
      
    case 'message_deleted':
      setMessages((prev) =>
        prev.map((msg) =>
          msg.id === data.messageId
            ? { ...msg, isDeleted: true, deletedAt: data.deletedAt }
            : msg
        )
      );
      break;
      
    case 'message_starred':
      setMessages((prev) =>
        prev.map((msg) =>
          msg.id === data.messageId
            ? { ...msg, isStarred: data.isStarred, starredAt: data.starredAt }
            : msg
        )
      );
      break;
      
    case 'message_status':
      // ç°æœ‰ä»£ç ä¿æŒä¸å˜
      break;
  }
}, [lastMessage]);
```

---

## æ­¥éª¤ 9: æ›´æ–°æ¶ˆæ¯æ¸²æŸ“ï¼ˆæ›¿æ¢åŸæœ‰çš„æ¶ˆæ¯æ¸²æŸ“éƒ¨åˆ†ï¼‰

æ‰¾åˆ°æ¶ˆæ¯æ¸²æŸ“çš„éƒ¨åˆ†ï¼Œæ›´æ–°ä¸ºï¼š

```typescript
{messages.map((message, index) => {
  const isOwn = message.direction === 'OUT' || message.fromMe;
  const isEditing = editingMessageId === message.id;
  
  return (
    <div
      key={message.id}
      ref={index === messages.length - 1 ? lastMessageRef : null}
      onContextMenu={(e) => handleMessageContextMenu(e, message)}
      style={{
        display: 'flex',
        justifyContent: isOwn ? 'flex-end' : 'flex-start',
        marginBottom: '8px',
        padding: '0 12px',
      }}
    >
      <div
        style={{
          maxWidth: '65%',
          backgroundColor: isOwn ? WhatsAppColors.ownMessage : WhatsAppColors.otherMessage,
          borderRadius: '8px',
          padding: '8px 12px',
        }}
      >
        {/* å¼•ç”¨çš„æ¶ˆæ¯ */}
        {message.replyTo && (
          <div style={{ marginBottom: '8px' }}>
            <QuotedMessage
              message={message.replyTo}
              onJumpTo={(id) => console.log('è·³è½¬åˆ°:', id)}
              compact
            />
          </div>
        )}
        
        {/* åª’ä½“å†…å®¹ */}
        {message.mediaUrl && (
          <div style={{ marginBottom: message.text ? '8px' : 0 }}>
            <MediaPreview
              mediaUrl={message.mediaUrl}
              mediaType={message.mediaType}
              mediaMimeType={message.mediaMimeType}
              mediaFileName={message.mediaFileName}
              mediaSize={message.mediaSize}
              thumbnailUrl={message.thumbnailUrl}
              duration={message.duration}
            />
          </div>
        )}
        
        {/* ç¼–è¾‘æ¨¡å¼æˆ–æ¶ˆæ¯æ–‡æœ¬ */}
        {isEditing ? (
          <MessageEditor
            initialText={message.text || ''}
            onSave={(newText) => handleEditMessage(message.id, newText)}
            onCancel={() => setEditingMessageId(null)}
          />
        ) : (
          <>
            {message.isDeleted ? (
              <div style={{ fontStyle: 'italic', color: '#8696a0' }}>
                æ­¤æ¶ˆæ¯å·²åˆ é™¤
              </div>
            ) : message.text && (
              <div style={{ whiteSpace: 'pre-wrap', wordBreak: 'break-word' }}>
                {message.text}
              </div>
            )}
            
            {/* ç¿»è¯‘æ–‡æœ¬ï¼ˆå¦‚æœæœ‰ï¼‰ */}
            {message.translatedText && !message.isDeleted && (
              <div
                style={{
                  marginTop: '8px',
                  paddingTop: '8px',
                  borderTop: '1px solid rgba(0,0,0,0.1)',
                  color: '#667781',
                  fontSize: '13px',
                }}
              >
                <div style={{ fontSize: '11px', marginBottom: '4px' }}>ğŸŒ ç¿»è¯‘:</div>
                {message.translatedText}
              </div>
            )}
            
            {/* æ¶ˆæ¯å…ƒæ•°æ® */}
            <div
              style={{
                display: 'flex',
                justifyContent: 'flex-end',
                alignItems: 'center',
                gap: '4px',
                marginTop: '4px',
                fontSize: '11px',
                color: 'rgba(0,0,0,0.45)',
              }}
            >
              {message.isEdited && <span>å·²ç¼–è¾‘</span>}
              {message.isStarred && <span>â­</span>}
              <span>
                {new Date(message.createdAt).toLocaleTimeString('zh-CN', {
                  hour: '2-digit',
                  minute: '2-digit',
                })}
              </span>
              {isOwn && (
                <span>
                  {message.readAt ? 'âœ“âœ“' : message.deliveredAt ? 'âœ“âœ“' : 'âœ“'}
                </span>
              )}
            </div>
          </>
        )}
      </div>
    </div>
  );
})}
```

---

## æ­¥éª¤ 10: æ›´æ–°èŠå¤©å¤´éƒ¨ï¼ˆåœ¨ç°æœ‰èŠå¤©å¤´éƒ¨ä¸­æ·»åŠ ï¼‰

åœ¨èŠå¤©å¤´éƒ¨æ·»åŠ æœç´¢æŒ‰é’®ï¼š

```typescript
{/* åœ¨ç°æœ‰èŠå¤©å¤´éƒ¨çš„å³ä¾§æ·»åŠ  */}
<div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
  {/* æœç´¢æŒ‰é’® */}
  <button
    onClick={() => setShowSearch(!showSearch)}
    style={{
      width: '40px',
      height: '40px',
      borderRadius: '50%',
      border: 'none',
      backgroundColor: showSearch ? WhatsAppColors.selected : 'transparent',
      cursor: 'pointer',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      fontSize: '20px',
    }}
    title="æœç´¢æ¶ˆæ¯"
  >
    ğŸ”
  </button>
</div>
```

åœ¨èŠå¤©å¤´éƒ¨ä¸‹æ–¹æ·»åŠ æœç´¢ç»„ä»¶ï¼š

```typescript
{/* åœ¨èŠå¤©å¤´éƒ¨åæ·»åŠ  */}
{showSearch && (
  <MessageSearch
    threadId={threadId}
    onMessageClick={(messageId) => {
      console.log('è·³è½¬åˆ°æ¶ˆæ¯:', messageId);
    }}
    onClose={() => setShowSearch(false)}
  />
)}
```

---

## æ­¥éª¤ 11: æ›´æ–°è¾“å…¥åŒºåŸŸ

åœ¨è¾“å…¥åŒºåŸŸçš„å¼€å¤´æ·»åŠ å¼•ç”¨é¢„è§ˆï¼š

```typescript
<div style={styles.inputContainer}>
  {/* å¼•ç”¨æ¶ˆæ¯é¢„è§ˆ */}
  {replyToMessage && (
    <div style={{ padding: '8px 12px', backgroundColor: WhatsAppColors.background }}>
      <QuotedMessage
        message={replyToMessage}
        onCancel={() => setReplyToMessage(null)}
        compact
      />
    </div>
  )}
  
  {/* ç°æœ‰çš„è¾“å…¥è¡Œ */}
  <div style={styles.inputRow}>
    {/* æ·»åŠ é™„ä»¶æŒ‰é’® */}
    <button
      onClick={() => setShowMediaUploader(true)}
      style={{
        width: '40px',
        height: '40px',
        borderRadius: '50%',
        border: 'none',
        backgroundColor: 'transparent',
        cursor: 'pointer',
        fontSize: '24px',
      }}
      title="é™„ä»¶"
    >
      ğŸ“
    </button>
    
    {/* ç°æœ‰çš„è¾“å…¥æ¡†å’Œå…¶ä»–æŒ‰é’®ä¿æŒä¸å˜ */}
  </div>
</div>
```

---

## æ­¥éª¤ 12: æ·»åŠ å¯¹è¯æ¡†ç»„ä»¶ï¼ˆåœ¨ return çš„æœ€åï¼‰

```typescript
{/* åœ¨ return è¯­å¥çš„æœ€åï¼Œ</WhatsAppLayout> ä¹‹å‰æ·»åŠ  */}

{/* å³é”®èœå• */}
{contextMenu?.show && (
  <MessageContextMenu
    x={contextMenu.x}
    y={contextMenu.y}
    items={getMessageMenuItems(contextMenu.message, {
      onReply: () => handleReplyMessage(contextMenu.message),
      onEdit: () => setEditingMessageId(contextMenu.message.id),
      onDelete: () => handleDeleteMessage(contextMenu.message),
      onForward: () => {
        setForwardMessage(contextMenu.message);
        setShowForwardDialog(true);
      },
      onStar: () => handleStarMessage(contextMenu.message),
      onCopy: () => handleCopyMessage(contextMenu.message),
    })}
    onClose={() => setContextMenu(null)}
  />
)}

{/* è½¬å‘å¯¹è¯æ¡† */}
{showForwardDialog && forwardMessage && (
  <ForwardDialog
    message={forwardMessage}
    onForward={handleForwardMessage}
    onClose={() => {
      setShowForwardDialog(false);
      setForwardMessage(null);
    }}
  />
)}

{/* åª’ä½“ä¸Šä¼ å™¨ */}
{showMediaUploader && (
  <div
    style={{
      position: 'fixed',
      top: 0,
      left: 0,
      right: 0,
      bottom: 0,
      backgroundColor: 'rgba(0, 0, 0, 0.5)',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      zIndex: 9999,
    }}
    onClick={() => setShowMediaUploader(false)}
  >
    <div
      onClick={(e) => e.stopPropagation()}
      style={{
        backgroundColor: WhatsAppColors.panelBackground,
        borderRadius: '12px',
        padding: '24px',
        maxWidth: '500px',
        width: '90%',
      }}
    >
      <h3 style={{ marginBottom: '16px' }}>ä¸Šä¼ æ–‡ä»¶</h3>
      <MediaUploader
        onUploadComplete={handleMediaUpload}
        onUploadError={(error) => {
          console.error('ä¸Šä¼ å¤±è´¥:', error);
          alert('ä¸Šä¼ å¤±è´¥: ' + error.message);
        }}
      />
      <button
        onClick={() => setShowMediaUploader(false)}
        style={{
          marginTop: '16px',
          padding: '8px 16px',
          width: '100%',
          border: 'none',
          borderRadius: '6px',
          backgroundColor: WhatsAppColors.border,
          cursor: 'pointer',
        }}
      >
        å–æ¶ˆ
      </button>
    </div>
  </div>
)}
```

---

## âœ… é›†æˆå®Œæˆæ£€æŸ¥æ¸…å•

å®Œæˆæ‰€æœ‰æ­¥éª¤åï¼Œæ£€æŸ¥ï¼š

- [ ] æ‰€æœ‰æ–°å¯¼å…¥éƒ½å·²æ·»åŠ 
- [ ] æ‰€æœ‰æ–°çŠ¶æ€éƒ½å·²æ·»åŠ 
- [ ] è‰ç¨¿è‡ªåŠ¨ä¿å­˜åŠŸèƒ½æ­£å¸¸
- [ ] åˆ†é¡µåŠ è½½åŠŸèƒ½æ­£å¸¸
- [ ] æ‰€æœ‰æ¶ˆæ¯æ“ä½œå‡½æ•°éƒ½å·²æ·»åŠ 
- [ ] handleSendMessage æ”¯æŒå¼•ç”¨å›å¤
- [ ] WebSocket äº‹ä»¶å¤„ç†å·²æ›´æ–°
- [ ] æ¶ˆæ¯æ¸²æŸ“åŒ…å«æ‰€æœ‰æ–°åŠŸèƒ½
- [ ] èŠå¤©å¤´éƒ¨æœ‰æœç´¢æŒ‰é’®
- [ ] è¾“å…¥åŒºåŸŸæœ‰å¼•ç”¨é¢„è§ˆå’Œé™„ä»¶æŒ‰é’®
- [ ] æ‰€æœ‰å¯¹è¯æ¡†ç»„ä»¶éƒ½å·²æ·»åŠ 

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: å¯¼å…¥é”™è¯¯
A: ç¡®ä¿æ‰€æœ‰ç»„ä»¶æ–‡ä»¶éƒ½åœ¨æ­£ç¡®çš„ä½ç½®

### Q: TypeScript ç±»å‹é”™è¯¯
A: ç¡®ä¿ `web/lib/api.ts` å·²æ›´æ–°

### Q: è¿è¡Œæ—¶é”™è¯¯
A: æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ï¼Œé€æ­¥æ’æŸ¥

---

**å®Œæˆåï¼Œæ‰€æœ‰æ–°åŠŸèƒ½å°†åœ¨èŠå¤©é¡µé¢ä¸­å¯ç”¨ï¼**


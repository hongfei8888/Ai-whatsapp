# 🎨 媒体消息显示 - 快速测试

> 3 分钟验证媒体消息功能

---

## 🚀 准备工作

### 1. 编译并重启后端

```bash
cd server
npm run build
# 停止旧进程，启动新进程
npm start
```

### 2. 刷新前端页面

刷新浏览器，清除缓存（Ctrl + F5）

---

## ✅ 快速测试

### 测试 1：接收图片 📷

**操作：**
1. 用手机 WhatsApp 发送一张图片
2. 观察前端对话页面

**预期：**
✅ 图片立即显示  
✅ 显示缩略图  
✅ 点击可放大查看  

---

### 测试 2：接收视频 🎥

**操作：**
1. 用手机 WhatsApp 发送一个视频
2. 观察前端对话页面

**预期：**
✅ 视频缩略图显示  
✅ 显示播放按钮▶️  
✅ 显示时长  
✅ 点击可播放  

---

### 测试 3：接收文档 📄

**操作：**
1. 用手机 WhatsApp 发送文档（PDF/Word/Excel）
2. 观察前端对话页面

**预期：**
✅ 文档图标显示  
✅ 显示文件名  
✅ 显示文件大小  
✅ 点击可下载  

---

### 测试 4：发送媒体 📤

**操作：**
1. 在前端点击 📎 按钮
2. 选择图片/视频/文档
3. 点击发送

**预期：**
✅ 媒体立即显示（绿色气泡，靠右）  
✅ 显示预览  
✅ 无需刷新  

---

## 🐛 常见问题

### 问题：媒体不显示

**解决：**
1. 确认后端已重启
2. 刷新浏览器（Ctrl + F5）
3. 查看浏览器控制台（F12）是否有错误

### 问题：只有文字，没有媒体

**检查：**
```javascript
// 打开浏览器控制台，输入：
console.log('最新消息:', messages[messages.length - 1]);
// 查看是否有 mediaUrl 字段
```

如果没有 `mediaUrl` 字段，说明后端没有正确广播。

---

## 📊 查看日志

### 后端日志

**查找媒体相关日志：**

```bash
# Windows PowerShell:
Select-String -Path "server-log.txt" -Pattern "hasMedia"

# 应该看到：
📨 接收消息已广播到前端 hasMedia=true mediaType=image
```

### 前端日志

**打开控制台（F12）：**

查找：
- `📨 [聊天详情] 收到新消息`
- 查看消息对象是否包含 `mediaUrl`

---

## ✅ 成功标准

- [x] 图片消息实时显示
- [x] 视频消息实时显示
- [x] 文档消息实时显示
- [x] 发送媒体实时显示
- [x] 点击可查看/播放/下载

---

## 📚 详细文档

查看完整的修复说明：
- [媒体消息显示-修复报告.md](./媒体消息显示-修复报告.md)

---

**现在可以开始测试了！** 🎉

有任何问题欢迎查看完整文档。


# 📡 前后端对接状态说明

## 当前状态

### ✅ 已完成的工作

1. **前端重构完成**
   - ✓ WhatsApp Web 风格的 UI
   - ✓ 三栏布局（功能导航 + 列表 + 详情）
   - ✓ 所有页面已重构
   - ✓ 统一的配色方案

2. **API 集成准备完成**
   - ✓ API 客户端配置 (`web/lib/api.ts`)
   - ✓ 类型定义完整 (`web/lib/types.ts`)
   - ✓ 错误降级处理（无法连接时使用模拟数据）

3. **自动化启动脚本**
   - ✓ PowerShell 脚本 (`start-servers.ps1`) - 自动创建配置文件
   - ✓ 批处理脚本 (`start-dev.bat`) - 自动创建配置文件
   - ✓ 连接测试脚本 (`test-connection.ps1`)

### ⚠️ 需要的配置

前后端对接需要以下配置文件（启动脚本会**自动创建**）：

#### 后端配置 (`server/.env`)
```env
PORT=4000
HOST=0.0.0.0
DATABASE_URL=file:../prisma/dev.db
NODE_ENV=development
```

#### 前端配置 (`web/.env.local`)
```env
NEXT_PUBLIC_API_BASE_URL=http://localhost:4000
```

## 🚀 快速启动（推荐）

### 方法一：使用 PowerShell 脚本（最简单）

```powershell
.\start-servers.ps1
```

这个脚本会：
1. ✓ 自动检查并创建配置文件
2. ✓ 启动后端服务器（端口 4000）
3. ✓ 启动前端服务器（端口 3000）
4. ✓ 打开两个终端窗口显示日志

### 方法二：使用批处理文件

```cmd
start-dev.bat
```

功能与 PowerShell 脚本相同。

### 方法三：手动启动

**终端 1 - 后端：**
```bash
cd server
npm install
npm run dev
```

**终端 2 - 前端：**
```bash
cd web
npm install
npm run dev
```

## 📊 验证对接状态

### 测试脚本
```powershell
.\test-connection.ps1
```

这个脚本会检查：
- ✓ 后端 API 是否响应（http://localhost:4000）
- ✓ 前端服务器是否运行（http://localhost:3000）
- ✓ 配置文件是否存在

### 手动验证

1. **后端状态检查**
   ```
   访问: http://localhost:4000/status
   预期: 返回 JSON 状态数据
   ```

2. **前端访问**
   ```
   访问: http://localhost:3000
   预期: 显示 WhatsApp Web 风格界面
   ```

3. **浏览器控制台**
   - 打开 http://localhost:3000
   - 按 F12 打开开发者工具
   - 查看 Console 和 Network 标签
   - 应该看到成功的 API 请求

## ✅ 成功的标志

### 后端成功启动
```
{"level":30,"msg":"Fastify server started","port":4000,"host":"0.0.0.0"}
```

### 前端成功启动
```
✓ Ready on http://localhost:3000
```

### API 连接成功
- 仪表盘显示真实数据
- 没有 "Failed to fetch" 错误
- 可以执行登录、查看联系人等操作

## 🔧 故障排查

### 问题 1: "Failed to fetch" 错误

**原因：** 后端未启动或配置错误

**解决方案：**
1. 确认后端在运行：`netstat -ano | findstr :4000`
2. 检查配置文件：`server/.env` 和 `web/.env.local`
3. 重新启动：`.\start-servers.ps1`

### 问题 2: 端口被占用

**查看占用：**
```powershell
netstat -ano | findstr :4000
netstat -ano | findstr :3000
```

**结束进程：**
```powershell
taskkill /PID <进程ID> /F
```

### 问题 3: 配置文件缺失

**自动创建：**
运行 `start-servers.ps1` 或 `start-dev.bat` 会自动创建

**手动创建：**
参考上面的配置示例手动创建文件

## 📝 API 端点列表

当前前端使用的 API：

- `GET /status` - 系统状态
- `GET /contacts` - 联系人列表
- `GET /threads` - 会话列表
- `GET /threads/:id/messages` - 会话消息
- `POST /messages/send` - 发送消息
- `POST /login/start` - 开始登录
- `POST /logout` - 退出登录

## 🎯 下一步

1. **启动系统**
   ```powershell
   .\start-servers.ps1
   ```

2. **访问应用**
   ```
   http://localhost:3000
   ```

3. **扫码登录 WhatsApp**
   - 点击左侧导航的"仪表盘"
   - 点击"扫码登录"按钮
   - 用手机扫描二维码

4. **开始使用**
   - 💬 查看聊天
   - 👥 管理联系人
   - 🤖 设置 AI 自动回复

---

## 📞 技术支持

**状态总结：**
- ✅ 前端界面：完成
- ✅ API 集成：完成
- ✅ 配置脚本：完成
- ⏳ 后端启动：需要运行

**快速启动命令：**
```powershell
.\start-servers.ps1
```

一切就绪！🎉


# 🚀 WhatsApp 自动化系统启动指南

## 前置要求

- Node.js >= 20.0.0
- npm 或 pnpm

## 快速启动

### 方法一：使用启动脚本（推荐）

**Windows PowerShell:**
```powershell
.\start-servers.ps1
```

**Windows 批处理:**
```cmd
start-dev.bat
```

### 方法二：手动启动

#### 1️⃣ 启动后端服务器（端口 4000）

```bash
# 在项目根目录
cd server
npm install
npm run dev
```

或者从根目录：
```bash
npm run dev:server
```

✅ 后端成功启动后，你会看到：
```
{"level":30,"time":...,"msg":"Fastify server started","port":4000,"host":"0.0.0.0"}
```

#### 2️⃣ 启动前端开发服务器（端口 3000）

打开**新的终端窗口**：

```bash
# 在项目根目录
cd web
npm install
npm run dev
```

或者从根目录：
```bash
npm run dev:web
```

✅ 前端成功启动后，访问：
```
http://localhost:3000
```

## 配置文件说明

### 后端配置 (`server/.env`)
```env
PORT=4000                    # 后端服务器端口
HOST=0.0.0.0                # 监听地址
DATABASE_URL="file:../prisma/dev.db"  # 数据库路径
NODE_ENV=development        # 环境
```

### 前端配置 (`web/.env.local`)
```env
NEXT_PUBLIC_API_BASE_URL=http://localhost:4000  # 后端 API 地址
```

## 常见问题

### ❌ "Failed to fetch" 错误

**原因：** 后端服务器未启动或端口配置错误

**解决方案：**
1. 检查后端是否在运行（端口 4000）
2. 检查 `web/.env.local` 中的 API URL 配置
3. 确保没有端口冲突

### ❌ 端口被占用

**查看端口占用：**
```bash
# Windows
netstat -ano | findstr :4000
netstat -ano | findstr :3000

# 结束进程（使用上面命令找到的 PID）
taskkill /PID <PID> /F
```

### ❌ 数据库错误

**重置数据库：**
```bash
cd server
npm run prisma:push
```

## 开发工具

### 查看日志
- 后端日志：终端窗口 1
- 前端日志：终端窗口 2 + 浏览器控制台

### 热重载
- 后端：保存文件自动重启
- 前端：保存文件自动刷新浏览器

## 生产环境部署

### 1. 构建项目
```bash
# 构建后端
cd server
npm run build

# 构建前端
cd ../web
npm run build
```

### 2. 启动生产服务器
```bash
# 后端
cd server
npm start

# 前端
cd web
npm start
```

## 项目结构

```
whatsapp-web.js-main/
├── server/                # 后端服务器 (Fastify + TypeScript)
│   ├── app/src/          # 源代码
│   ├── .env              # 后端环境变量
│   └── package.json
│
├── web/                   # 前端应用 (Next.js 15)
│   ├── app/              # 应用页面
│   ├── components/       # 组件
│   ├── lib/              # 工具库
│   ├── .env.local        # 前端环境变量
│   └── package.json
│
└── prisma/               # 数据库
    └── dev.db
```

## 功能导航

访问 `http://localhost:3000` 后：

- 📊 **仪表盘** (`/dashboard`) - 系统概览
- 💬 **聊天** (`/chat`) - WhatsApp 聊天界面
- 👥 **联系人** (`/contacts`) - 联系人管理
- 📱 **会话** (`/threads`) - 会话管理
- 📝 **模板** (`/templates`) - 消息模板
- 📤 **批量操作** (`/batch`) - 批量发送
- 📚 **知识库** (`/knowledge`) - 知识库管理
- ⚙️ **设置** (`/settings`) - 系统设置

## 技术支持

遇到问题？检查：
1. ✅ Node.js 版本 >= 20
2. ✅ 后端服务器运行在 4000 端口
3. ✅ 前端服务器运行在 3000 端口
4. ✅ `.env` 文件配置正确
5. ✅ 依赖已全部安装

---

🎉 享受使用 WhatsApp 自动化系统！


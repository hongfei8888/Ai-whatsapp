# ⚡ 翻译功能快速配置指南

## 🎉 已完成的开发工作

所有代码已实现！以下是修改的文件：

### ✅ 数据库
- `prisma/schema.prisma` - 添加 Translation 表和相关字段

### ✅ 后端服务
- `server/app/src/services/translation-service.ts` - 翻译服务（新建）
- `server/app/src/routes/translation.ts` - 翻译路由（新建）
- `server/app/src/server.ts` - 注册翻译路由

### ✅ 前端页面
- `web/app/chat/[id]/page.tsx` - 集成翻译功能
- `web/lib/api.ts` - 添加翻译 API 调用

### ✅ 配置文件
- `server/env.example` - 添加环境变量示例

## 🚀 你需要完成的步骤

### 步骤 1：申请百度翻译 API（5分钟）

1. 访问：https://fanyi-api.baidu.com/
2. 注册/登录百度账号
3. 进入"管理控制台" → "开发者信息"
4. 点击"申请接入" → 选择"通用翻译API"
5. 创建应用，获取 **APP ID** 和 **密钥**

### 步骤 2：配置环境变量（1分钟）

在 `server/.env` 文件中添加：

```env
# 百度翻译 API 配置
BAIDU_TRANSLATE_APP_ID=你的APP_ID
BAIDU_TRANSLATE_SECRET_KEY=你的密钥
```

> 💡 如果没有 `.env` 文件，复制 `server/env.example` 为 `server/.env`

### 步骤 3：安装依赖（如需要）

```bash
cd server/app
npm install axios
```

### 步骤 4：重启服务器

```bash
# 停止当前服务器（Ctrl+C）
# 重新启动
cd server/app
npm run dev
```

### 步骤 5：测试翻译功能

1. 打开浏览器，访问对话页面
2. 点击右上角 **"🌐 翻译关"** 按钮
3. 发送或接收消息，查看自动翻译
4. 点击消息右侧的 **"🌐"** 图标手动翻译

## ✨ 功能预览

### 全局开关
```
聊天头部：[🌐 翻译开] ← 点击切换
```

### 手动翻译
```
消息气泡：Hello, how are you?  🌐 ← 点击翻译
           ┃ 🌐 译文：你好，你好吗？
```

### 翻译后发送
```
输入框：你好 [🌐➤] [➤]
        ↑        ↑
        翻译     直接
        后发送    发送
```

## 📊 费用说明

- **免费版**：100万字符/月（约5万条短消息）
- **标准版**：49元/100万字符
- **智能缓存**：节省 60-80% API 调用

## ⚠️ 重要提示

1. ❌ **不要**将 `.env` 文件提交到 Git
2. ✅ **确保** `.env` 在 `.gitignore` 中
3. ✅ **定期检查** 百度翻译账号余额
4. ✅ **建议启用** 缓存清理定时任务

## 🐛 如果遇到问题

### 问题：翻译不工作
**检查清单**：
- [ ] `.env` 文件已配置
- [ ] APP ID 和密钥正确
- [ ] 后端服务器已重启
- [ ] 浏览器控制台无错误

### 问题：提示 API 错误
**可能原因**：
- API 密钥错误
- 账号余额不足
- 网络连接问题

### 查看日志
```bash
# 后端日志
cd server/app
npm run dev

# 浏览器控制台
按 F12 → Console 标签
```

## 📚 完整文档

详细使用说明请参考：`翻译功能使用说明.md`

---

**配置完成后，立即享受智能翻译功能！🎉**


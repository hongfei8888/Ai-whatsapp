# 🔧 修复 "Failed to fetch" 错误

## 问题原因

前端无法连接到后端服务器，原因是：
1. ❌ 后端服务器未启动
2. ❌ 端口配置不匹配

## 快速修复步骤

### 步骤 1：创建环境配置文件

#### 1.1 创建后端配置
在 `server` 目录下创建 `.env` 文件：

```bash
cd server
copy .env.example .env
```

或手动创建 `server/.env` 文件，内容：
```env
PORT=4000
HOST=0.0.0.0
DATABASE_URL="file:../prisma/dev.db"
NODE_ENV=development
```

#### 1.2 创建前端配置
在 `web` 目录下创建 `.env.local` 文件：

```bash
cd web
copy .env.local.example .env.local
```

或手动创建 `web/.env.local` 文件，内容：
```env
NEXT_PUBLIC_API_BASE_URL=http://localhost:4000
```

### 步骤 2：启动后端服务器

打开**第一个终端窗口**：

```bash
# 方式 1：从根目录启动
npm run dev:server

# 方式 2：进入 server 目录启动
cd server
npm install
npm run dev
```

✅ **成功提示：** 看到以下信息说明后端启动成功：
```
{"level":30,"msg":"Fastify server started","port":4000,"host":"0.0.0.0"}
```

### 步骤 3：启动前端服务器

打开**第二个终端窗口**（保持第一个窗口运行）：

```bash
# 方式 1：从根目录启动
npm run dev:web

# 方式 2：进入 web 目录启动
cd web
npm install
npm run dev
```

✅ **成功提示：** 看到以下信息：
```
- Local:        http://localhost:3000
```

### 步骤 4：访问应用

在浏览器打开：
```
http://localhost:3000
```

现在应该可以正常使用了！🎉

## 验证是否成功

### ✅ 检查清单

1. **后端运行中**
   - 终端显示 "Fastify server started"
   - 端口 4000 被占用
   - 访问 http://localhost:4000/status 有响应

2. **前端运行中**
   - 终端显示 Next.js 启动信息
   - 端口 3000 被占用
   - 浏览器可以打开页面

3. **API 连接正常**
   - 仪表盘显示系统状态
   - 没有 "Failed to fetch" 错误
   - 浏览器控制台没有网络错误

## 如果还是不行

### 检查端口占用

**Windows PowerShell:**
```powershell
# 检查 4000 端口
netstat -ano | findstr :4000

# 检查 3000 端口
netstat -ano | findstr :3000

# 如果被占用，结束进程
taskkill /PID <进程ID> /F
```

### 重置环境

```bash
# 1. 停止所有服务（Ctrl+C）

# 2. 清理依赖
cd server
rm -rf node_modules
npm install

cd ../web
rm -rf node_modules
npm install

# 3. 重新启动
npm run dev:server  # 终端 1
npm run dev:web     # 终端 2
```

### 查看详细日志

1. **后端日志：** 查看启动后端的终端窗口
2. **前端日志：** 
   - 启动前端的终端窗口
   - 浏览器控制台（F12）

## 临时解决方案

如果暂时无法启动后端，前端已经添加了降级方案，会显示：
- ⚠️ "无法连接到后端服务器，使用模拟数据"
- 仪表盘会显示离线状态
- 某些功能会受限

但这只是临时方案，完整功能需要后端运行！

## 使用 PowerShell 脚本（推荐）

如果你有 `start-servers.ps1` 文件，直接运行：

```powershell
# 在项目根目录
.\start-servers.ps1
```

这会自动启动前后端服务器！

---

💡 **提示：** 保持两个终端窗口一直运行，关闭它们会停止服务器。


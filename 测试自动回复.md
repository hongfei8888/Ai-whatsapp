# 🧪 自动回复功能测试指南

## 步骤1：检查系统状态

### 1.1 访问管理台
- 打开浏览器访问：`http://localhost:3000` 或 `http://localhost:3001`
- 进入 Dashboard 页面

### 1.2 检查 WhatsApp 状态
- 状态应该显示为 "Online"
- 如果是 "Awaiting QR"，需要重新扫码
- 如果是其他状态，重启后端服务

## 步骤2：正确的测试流程

### 2.1 添加测试联系人
1. 进入 **Contacts** 页面
2. 点击 "Add Contact" 按钮
3. 输入您自己的另一个手机号（E.164格式，如：+8613800138000）
4. 输入姓名：测试联系人

### 2.2 发送首发消息
1. 在联系人列表找到刚添加的联系人
2. 点击 "Outreach" 按钮
3. 输入测试消息：
   ```
   您好，这是一条测试消息，请回复任意内容测试自动回复功能。
   ```
4. 点击发送

### 2.3 触发自动回复
1. 用另一个手机收到消息后，回复任意内容，如："你好"
2. 系统应该会自动回复

## 步骤3：验证自动回复

### 3.1 检查对话状态
1. 进入 **Threads** 页面
2. 找到对应的对话线程
3. 检查 AI 状态是否为 "Active"
4. 检查消息流是否包含自动回复

### 3.2 测试不同回复类型

发送以下测试消息验证三层回复机制：

**测试关键词匹配：**
- 发送："你好" → 应该回复欢迎语
- 发送："价格" → 应该回复价格相关信息
- 发送："退款" → 应该回复退款处理信息

**测试 AI 智能回复：**
- 发送："你们的产品有什么特点？"
- 发送："我需要技术支持"
- 发送："怎么使用这个功能？"

**测试兜底回复：**
- 发送很复杂或无意义的内容，应该回复："我记录下来了，会尽快回复你。"

## 步骤4：常见问题解决

### 4.1 如果完全没有回复
1. 检查后端控制台是否有错误信息
2. 确认 DEEPSEEK_API_KEY 是否有效
3. 检查网络连接是否正常

### 4.2 如果回复不正确
1. 检查 API 密钥是否有效
2. 查看后端日志中的错误信息
3. 验证 DeepSeek API 配额是否充足

### 4.3 如果回复延迟
1. 检查网络延迟
2. 确认 DeepSeek API 响应时间
3. 查看系统负载情况

## 步骤5：高级调试

### 5.1 查看后端日志
在后端控制台查找以下关键信息：
- `"incoming request"` - 收到消息
- `"AI reply"` - AI 回复生成
- `"WhatsApp message sent"` - 消息发送成功

### 5.2 数据库检查
```bash
# 检查消息记录
npx prisma studio
```
- 打开 Messages 表查看消息记录
- 检查 direction 字段：IN（入站）/ OUT（出站）
- 检查 status 字段：SENT / FAILED

### 5.3 API 直接测试
```bash
# 测试状态接口
curl -H "Authorization: Bearer change-me" http://localhost:4000/status

# 测试线程列表
curl -H "Authorization: Bearer change-me" http://localhost:4000/threads
```

## 🎯 成功标志

如果一切正常，您应该看到：
- [x] WhatsApp 状态显示 "Online"
- [x] 能够添加联系人
- [x] 能够发送首发消息  
- [x] 对方回复后收到自动回复
- [x] Threads 页面显示完整对话
- [x] AI 状态显示为 "Active"

## 🆘 如果仍有问题

请提供以下信息以便进一步诊断：
1. WhatsApp 连接状态（Dashboard 显示）
2. 后端控制台的错误信息
3. 是否按照正确流程操作
4. DeepSeek API 密钥是否有效
5. 具体的操作步骤和预期 vs 实际结果

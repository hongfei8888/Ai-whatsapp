# 🧪 群组聊天页面 - 快速测试指南

## 📋 测试清单

### ✅ 测试 1：群组选择器页面

**访问地址：**
```
http://localhost:3000/groups/chat
```

**预期效果：**
- [ ] 左侧显示功能导航栏（Sidebar）
- [ ] 顶部显示"💬 选择群组聊天"标题
- [ ] 显示群组总数（例如：共 3 个群组）
- [ ] 群组以卡片网格形式显示
- [ ] 每个卡片显示：
  - [ ] 群组头像（首字母或 👥）
  - [ ] 群组名称
  - [ ] 成员数量

**交互测试：**
- [ ] 鼠标悬停在卡片上 → 卡片上浮 + 阴影效果
- [ ] 点击任意群组卡片 → 跳转到 `/chat/group/{id}`

**空状态测试：**
- [ ] 如果没有群组 → 显示"📭 暂无群组"
- [ ] 显示引导文字："请先在'群组管理'中同步群组"

---

### ✅ 测试 2：群组聊天页面（主功能）

**访问地址：**
```
http://localhost:3000/chat/group/{群组ID}
```

**预期效果：**
- [ ] 顶部显示群组名称
- [ ] 右侧显示"👥 成员列表"按钮
- [ ] 消息区域显示历史消息
- [ ] 底部显示输入框和工具栏

---

### ✅ 测试 3：发送消息

#### 3.1 文本消息
1. [ ] 在输入框输入文字："测试消息"
2. [ ] 点击"发送"按钮
3. [ ] ✅ 消息立即显示在聊天区域（绿色气泡）
4. [ ] ✅ 显示发送者名称"我"

#### 3.2 表情消息
1. [ ] 点击输入框左侧的"😊"表情按钮
2. [ ] ✅ 弹出表情选择器面板（z-index 1001）
3. [ ] 点击任意表情（如：😀）
4. [ ] ✅ 表情插入到输入框
5. [ ] 点击表情面板外部
6. [ ] ✅ 表情面板关闭
7. [ ] 点击"发送"
8. [ ] ✅ 表情消息显示在聊天区域

#### 3.3 图片消息
1. [ ] 点击"📎"附件按钮
2. [ ] 选择图片文件（.jpg/.png）
3. [ ] ✅ 上传成功（无 400/500 错误）
4. [ ] ✅ 图片消息显示在聊天区域
5. [ ] ✅ 显示图片缩略图
6. [ ] 点击图片
7. [ ] ✅ 打开原图（新标签页）

#### 3.4 其他媒体文件
- [ ] 视频文件 → 显示视频播放器
- [ ] 音频文件 → 显示音频播放器
- [ ] 文档文件 → 显示文件名 + 下载链接

---

### ✅ 测试 4：接收消息（实时更新）

**测试方法：用手机向群组发送消息**

1. [ ] 用手机发送文本消息："手机测试"
2. [ ] ✅ 前端立即显示（白色气泡）
3. [ ] ✅ 显示发送者名称（手机号码或昵称）
4. [ ] ✅ 消息自动滚动到底部

**测试图片接收：**
1. [ ] 用手机发送图片
2. [ ] ✅ 前端立即显示图片缩略图
3. [ ] ✅ 图片清晰可见（不模糊）
4. [ ] 点击图片
5. [ ] ✅ 打开原图

---

### ✅ 测试 5：群组成员功能

1. [ ] 点击右上角"👥 成员列表"
2. [ ] ✅ 显示成员列表侧边栏
3. [ ] ✅ 列出所有群组成员
4. [ ] 点击任意成员
5. [ ] ✅ 弹出确认对话框："是否与 {成员} 开始私聊？"
6. [ ] 点击"确认"
7. [ ] ✅ 跳转到一对一聊天页面 `/chat/{threadId}`

---

### ✅ 测试 6：页面导航一致性

**测试路径 A：**
```
/groups/chat → 点击群组卡片 → /chat/group/{id}
```

**测试路径 B：**
```
侧边栏"群组管理" → 群组聊天 → /groups/chat → 点击卡片 → /chat/group/{id}
```

**验证点：**
- [ ] 两种路径最终到达的页面完全一致
- [ ] 所有功能（发送、接收、表情、媒体）都正常

---

## 🐛 常见问题排查

### 问题 1：群组选择器显示空白

**检查点：**
```bash
# 浏览器控制台是否有错误？
# 检查 API 返回数据：
console.log(data);  // 应该是 { groups: [...], total: number }
```

**解决方案：**
- 确保 `setGroups(data?.groups || [])`（提取 groups 数组）

---

### 问题 2：点击群组卡片无反应

**检查点：**
```javascript
// 浏览器控制台是否有 log？
console.log('🔀 跳转到群组聊天:', groupId);
```

**解决方案：**
- 确保 `onClick={() => handleGroupClick(group.id)}`
- 确保 `router.push` 正常执行

---

### 问题 3：表情选择器点不动

**检查点：**
- [ ] `z-index` 是否足够高（1001）？
- [ ] 是否有遮挡元素？
- [ ] `stopPropagation` 是否正确？

**解决方案：**
```typescript
// 表情按钮
<div data-emoji-container onClick={(e) => {
  e.stopPropagation();
  setShowEmoji(prev => !prev);
}}>

// 表情面板
{showEmoji && (
  <div onClick={(e) => e.stopPropagation()}>
    {/* 表情列表 */}
  </div>
)}

// useEffect 关闭逻辑
useEffect(() => {
  if (!showEmoji) return;
  const timer = setTimeout(() => {
    document.addEventListener('click', handleClickOutside, true);
  }, 100);
  return () => {
    clearTimeout(timer);
    document.removeEventListener('click', handleClickOutside, true);
  };
}, [showEmoji]);
```

---

### 问题 4：媒体消息不显示

**检查点：**
- [ ] WebSocket `onGroupMessage` 是否包含媒体字段？
- [ ] 数据库是否保存了 `mediaUrl`, `mediaType` 等字段？
- [ ] 前端是否正确渲染媒体预览？

**验证代码：**
```typescript
// WebSocket 处理
onGroupMessage: (data) => {
  console.log('📨 收到群组消息:', data);
  console.log('📊 媒体字段:', {
    mediaUrl: data.mediaUrl,
    mediaType: data.mediaType,
    thumbnailUrl: data.thumbnailUrl,
  });
  
  const newMessage: GroupMessage = {
    // ...
    mediaUrl: data.mediaUrl,
    mediaType: data.mediaType,
    thumbnailUrl: data.thumbnailUrl,
    // ...
  };
  setMessages(prev => [...prev, newMessage]);
};
```

---

## 📊 测试结果记录

### 测试环境
- **日期：** 2025年10月11日
- **前端版本：** Next.js 15.5.4
- **后端服务：** Fastify + WPPConnect
- **浏览器：** Microsoft Edge

### 测试结果
| 测试项 | 状态 | 备注 |
|--------|------|------|
| 群组选择器显示 | ✅ | 正常显示群组列表 |
| 点击卡片跳转 | ✅ | 正常跳转到聊天页 |
| 发送文本消息 | ✅ | 实时显示 |
| 表情选择器 | ✅ | 可点击、可关闭 |
| 媒体上传 | ✅ | 图片/视频正常 |
| 实时接收消息 | ✅ | WebSocket 正常 |
| 媒体预览 | ✅ | 清晰显示 |
| 成员列表 | ✅ | 正常显示 |
| 私聊跳转 | ✅ | 正常跳转 |

---

## 🎉 测试通过标准

所有测试项 ✅ = **群组聊天页面统一成功！**

---

## 📞 支持

如有任何问题，请参考：
- [群组聊天页面-统一完成报告.md](./群组聊天页面-统一完成报告.md)
- [群组聊天页面-完整修复报告.md](./群组聊天页面-完整修复报告.md)

---

*祝测试顺利！* 🚀

